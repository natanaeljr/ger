cmake_minimum_required(VERSION 3.0)
include(ExternalProject)
include(GNUInstallDirs)

message(STATUS "Dependency library GTest - download")

set(GTEST googletest CACHE STRING "")
set(GTEST_INSTALL_PREFIX ${CMAKE_BINARY_DIR} CACHE STRING "")
set(GTEST_INCLUDE_DIRS ${GTEST_INSTALL_PREFIX}/include CACHE STRING "")
set(GTEST_LIBRARIES libgtest.a libgmock.a CACHE STRING "")
set(GTEST_MAIN_LIBRARIES libgmock_main.a CACHE STRING "")

list(TRANSFORM GTEST_LIBRARIES
  PREPEND ${GTEST_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}/
)
list(TRANSFORM GTEST_MAIN_LIBRARIES
  PREPEND ${GTEST_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}/
)

ExternalProject_Add(${GTEST}
  GIT_REPOSITORY    https://github.com/google/googletest.git
  GIT_TAG           master
  PREFIX            ${GTEST_INSTALL_PREFIX}
  CMAKE_ARGS        -DCMAKE_INSTALL_PREFIX=${GTEST_INSTALL_PREFIX}
  BUILD_COMMAND     ""
  TEST_COMMAND      ""
  LOG_DOWNLOAD      ON
  LOG_CONFIGURE     ON
  LOG_BUILD         ON
  UPDATE_DISCONNECTED 1
)
